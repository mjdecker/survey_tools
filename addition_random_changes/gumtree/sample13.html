<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tool4</title><link type="text/css" href="res/web/bootstrap.min.css" rel="stylesheet"/><link type="text/css" href="res/web/gumtree.css" rel="stylesheet"/></head><body><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="btn-toolbar pull-right"><div class="btn-group"><a class="btn btn-default btn-xs" id="legend" href="#" data-toggle="popover" data-html="true" data-placement="bottom" data-content="<span class=&quot;del&quot;>&nbsp;&nbsp;</span> deleted<br><span class=&quot;add&quot;>&nbsp;&nbsp;</span> added<br><span class=&quot;mv&quot;>&nbsp;&nbsp;</span> moved<br><span class=&quot;upd&quot;>&nbsp;&nbsp;</span> updated<br>" data-original-title="Legend" title="Legend" role="button">Legend</a><a class="btn btn-default btn-xs" id="shortcuts" href="#" data-toggle="popover" data-html="true" data-placement="bottom" data-content="<b>n</b> next<br><b>t</b> top<br><b>b</b> bottom" data-original-title="Shortcuts" title="Shortcuts" role="button">Shortcuts</a></div><div class="btn-group"></div></div></div></div><div class="row"><div class="col-lg-6 max-height"><h5>original.java</h5><pre class="pre max-height">public boolean enterWhenUninterruptibly(Guard guard, long time, TimeUnit unit) {
  if (guard.monitor != this) {
    throw new IllegalMonitorStateException();
  }
  final ReentrantLock lock = this.lock;
  boolean reentrant = lock.isHeldByCurrentThread();
  long startNanos = System.nanoTime();
  long timeoutNanos = unit.toNanos(time);
  long remainingNanos = timeoutNanos;
  boolean interruptIgnored = false;
  try {
    while (true) {
      try {
        if (lock.tryLock(remainingNanos, TimeUnit.NANOSECONDS)) {
          break;
        } else {
          return false;
        }
      } catch (InterruptedException ignored) {
        interruptIgnored = true;
      } finally {
        remainingNanos = (timeoutNanos - (System.nanoTime() - startNanos));
      }
    }
    boolean satisfied;
    try {
      satisfied = waitUninterruptibly(guard, remainingNanos, reentrant);
    } <span class="marker" id="mapping-1"></span><span class="token del" data-title="TryStatement/CatchClause">catch (Throwable throwable) <span class="marker" id="mapping-2"></span><span class="token mv" id="move-src-1" data-title="CatchClause/Block">{
      lock.unlock();
      <span class="marker" id="mapping-3"></span><span class="token del" data-title="Block/ThrowStatement">throw Throwables.propagate(throwable);</span>
    }</span></span>
    <span class="marker" id="mapping-4"></span><span class="token del" data-title="Block/IfStatement">if (satisfied) {
      return true;
    } else {
      lock.unlock();
      return false;
    }</span>
  } finally {
    if (interruptIgnored) {
      Thread.currentThread().interrupt();
    }
  }
}}
</pre></div><div class="col-lg-6 max-height"><h5>modified.java</h5><pre class="pre max-height">public boolean enterWhenUninterruptibly(Guard guard, long time, TimeUnit unit) {
    if (guard.monitor != this) {
      throw new IllegalMonitorStateException();
    }
    final ReentrantLock lock = this.lock;
    boolean reentrant = lock.isHeldByCurrentThread();
    long startNanos = System.nanoTime();
    long timeoutNanos = unit.toNanos(time);
    long remainingNanos = timeoutNanos;
    boolean interruptIgnored = false;
    try {
      while (true) {
        try {
          if (lock.tryLock(remainingNanos, TimeUnit.NANOSECONDS)) {
            break;
          } else {
            return false;
          }
        } catch (InterruptedException ignored) {
          interruptIgnored = true;
        } finally {
          remainingNanos = (timeoutNanos - (System.nanoTime() - startNanos));
        }
      }
      boolean satisfied = <span class="marker" id="mapping-5"></span><span class="token add" data-title="VariableDeclarationFragment/BooleanLiteral">false</span>;
      try {
        satisfied = waitUninterruptibly(guard, remainingNanos, reentrant);
      } finally <span class="marker" id="mapping-6"></span><span class="token add" data-title="TryStatement/Block">{
        if (!satisfied) <span class="marker" id="mapping-7"></span><span class="token mv" id="move-dst-1" data-title="IfStatement/Block">{
          lock.unlock();
        }</span>
      }</span>
      <span class="marker" id="mapping-8"></span><span class="token add" data-title="Block/ReturnStatement">return satisfied;</span>
    } finally {
      if (interruptIgnored) {
        Thread.currentThread().interrupt();
      }
    }
  }}
</pre></div></div></div><script type="text/javascript" src="res/web/jquery.min.js"></script><script type="text/javascript" src="res/web/bootstrap.min.js"></script><script type="text/javascript" src="res/web/diff.js"></script></body></html>