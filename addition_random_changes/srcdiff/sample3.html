<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Tool3</title></head><body><div style="font-family: courier, monospace;"><table style="border-collapse: collapse;"><tr><td style="border: 1px solid black;"><table><tr><th><strong>Original</strong></th></tr><tr><td><pre><span><span style="color: grey"> 1 </span></span><span><span style="background-color: transparent">@Before</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 2 </span></span><span><span style="background-color: transparent">public void setup() throws Exception {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 3 </span></span><span><span style="background-color: transparent">    super.setUp();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 4 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 5 </span></span><span><span style="background-color: transparent">    </span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 6 </span></span><span><span style="background-color: transparent">    strMapper = new StringFieldMapper.Builder("str_value")</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 7 </span></span><span><span style="background-color: transparent">            .build(new Mapper.BuilderContext(null, new ContentPath(1)));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 8 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 9 </span></span><span><span style="background-color: transparent">    lngMapper = new LongFieldMapper.Builder("lng_value")</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">10 </span></span><span><span style="background-color: transparent">            .build(new Mapper.BuilderContext(null, new ContentPath(1)));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">11 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">12 </span></span><span><span style="background-color: transparent">    dblMapper = new DoubleFieldMapper.Builder("dbl_value")</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">13 </span></span><span><span style="background-color: transparent">            .build(new Mapper.BuilderContext(null, new ContentPath(1)));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">14 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">15 </span></span><span><span style="background-color: transparent">    </span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">16 </span></span><span><span style="background-color: transparent">    </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">Index index = new Index("test");</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">17 </span></span><span><span style="background-color: transparent">    </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">CircuitBreakerService circuitBreakerService = new NoneCircuitBreakerService();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">18 </span></span><span><span style="background-color: transparent">    </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">IndicesFieldDataCache indicesFieldDataCache = new IndicesFieldDataCache(</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">19 </span></span><span><span style="background-color: transparent">            </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">ImmutableSettings.Builder.EMPTY_SETTINGS,</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">20 </span></span><span><span style="background-color: transparent">            </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">new IndicesFieldDataCacheListener(circuitBreakerService)</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">21 </span></span><span><span style="background-color: transparent">    </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">);</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">22 </span></span><span><span style="background-color: transparent">    </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">ifdService = new</span></span><span><span style="background-color: transparent"> </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">IndexFieldDataService(index,</span></span><span><span style="background-color: transparent"> ImmutableSettings.builder().put("index.fielddata.cache", "none").build()</span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">, indicesFieldDataCache, circuitBreakerService, new IndicesFieldDataCacheListener(circuitBreakerService))</span></span><span><span style="background-color: transparent">;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">23 </span></span><span><span style="background-color: transparent">    </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">MapperService mapperService = MapperTestUtils.newMapperService(ifdService.index(), ImmutableSettings.Builder.EMPTY_SETTINGS);</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">24 </span></span><span><span style="background-color: transparent">    </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">ifdService.setIndexService(new StubIndexService(mapperService));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">24 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">25 </span></span><span><span style="background-color: transparent">    IndexQueryParserService parserService = </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">new IndexQueryParserService(</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">26 </span></span><span><span style="background-color: transparent">            </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">index, ImmutableSettings.EMPTY, new IndicesQueriesRegistry(ImmutableSettings.EMPTY, ImmutableSet.&amp;lt;QueryParser&amp;gt;of(), ImmutableSet.&amp;lt;FilterParser&amp;gt;of()),</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">27 </span></span><span><span style="background-color: transparent">            </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">null, null, null, mapperService, null, ifdService, null, null, null, null</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">28 </span></span><span><span style="background-color: transparent">    </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">)</span></span><span><span style="background-color: transparent">;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">29 </span></span><span><span style="background-color: transparent">    parseContext = new QueryParseContext(</span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">index</span></span><span><span style="background-color: transparent">, parserService);</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">30 </span></span><span><span style="background-color: transparent">    writer = new IndexWriter(new RAMDirectory(),</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">31 </span></span><span><span style="background-color: transparent">            new IndexWriterConfig(Lucene.VERSION, new StandardAnalyzer(Lucene.VERSION)));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">32 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">33 </span></span><span><span style="background-color: transparent">    int numDocs = 10;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">34 </span></span><span><span style="background-color: transparent">    for (int i = 0; i &amp;lt; numDocs; i++) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">35 </span></span><span><span style="background-color: transparent">        Document d = new Document();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">36 </span></span><span><span style="background-color: transparent">        d.add(new StringField(strMapper.names().indexName(), "str" + i, Field.Store.NO));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">37 </span></span><span><span style="background-color: transparent">        d.add(new LongField(lngMapper.names().indexName(), i, Field.Store.NO));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">38 </span></span><span><span style="background-color: transparent">        d.add(new DoubleField(dblMapper.names().indexName(), Double.valueOf(i), Field.Store.NO));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">39 </span></span><span><span style="background-color: transparent">        writer.addDocument(d);</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">40 </span></span><span><span style="background-color: transparent">    }</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">41 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">42 </span></span><span><span style="background-color: transparent">    reader = SlowCompositeReaderWrapper.wrap(DirectoryReader.open(writer, true));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">43 </span></span><span><span style="background-color: transparent">}</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">44 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span></pre></td></tr></table></td><td style="border: 1px solid black; border-collapse: collapse;"><table><tr><th><strong>Modified</strong></th></tr><tr><td><pre><span><span style="color: grey"> 1 </span></span><span><span style="background-color: transparent">@Before</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 2 </span></span><span><span style="background-color: transparent">public void setup() throws Exception {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 3 </span></span><span><span style="background-color: transparent">    super.setUp();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 4 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 5 </span></span><span><span style="background-color: transparent">    </span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 6 </span></span><span><span style="background-color: transparent">    strMapper = new StringFieldMapper.Builder("str_value")</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 7 </span></span><span><span style="background-color: transparent">            .build(new Mapper.BuilderContext(null, new ContentPath(1)));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 8 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 9 </span></span><span><span style="background-color: transparent">    lngMapper = new LongFieldMapper.Builder("lng_value")</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">10 </span></span><span><span style="background-color: transparent">            .build(new Mapper.BuilderContext(null, new ContentPath(1)));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">11 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">12 </span></span><span><span style="background-color: transparent">    dblMapper = new DoubleFieldMapper.Builder("dbl_value")</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">13 </span></span><span><span style="background-color: transparent">            .build(new Mapper.BuilderContext(null, new ContentPath(1)));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">14 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">15 </span></span><span><span style="background-color: transparent">    </span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">16 </span></span><span><span style="background-color: transparent">    </span></span><span><span style="background-color: rgb(0,250,108)  ; font-weight: bold;">Settings settings =</span></span><span><span style="background-color: transparent">  ImmutableSettings.builder().put("index.fielddata.cache", "none").build();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">17 </span></span><span><span style="background-color: transparent">    </span></span><span><span style="background-color: rgb(0,250,108)  ; font-weight: bold;">IndexService indexService = createIndex("test", settings);</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">18 </span></span><span><span style="background-color: transparent">    </span></span><span><span style="background-color: rgb(0,250,108)  ; font-weight: bold;">ifdService = indexService.injector().getInstance(IndexFieldDataService.class);</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">19 </span></span><span><span style="background-color: transparent">    IndexQueryParserService parserService = </span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">19 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: rgb(0,250,108)  ; font-weight: bold;">indexService.queryParserService()</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">19 </span></span><span><span style="background-color: transparent">;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">20 </span></span><span><span style="background-color: transparent">    parseContext = new QueryParseContext(</span></span><span><span style="background-color: rgb(0,250,108)  ; font-weight: bold;">indexService.index()</span></span><span><span style="background-color: transparent">, parserService);</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">21 </span></span><span><span style="background-color: transparent">    writer = new IndexWriter(new RAMDirectory(),</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">22 </span></span><span><span style="background-color: transparent">            new IndexWriterConfig(Lucene.VERSION, new StandardAnalyzer(Lucene.VERSION)));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">23 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">24 </span></span><span><span style="background-color: transparent">    int numDocs = 10;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">25 </span></span><span><span style="background-color: transparent">    for (int i = 0; i &amp;lt; numDocs; i++) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">26 </span></span><span><span style="background-color: transparent">        Document d = new Document();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">27 </span></span><span><span style="background-color: transparent">        d.add(new StringField(strMapper.names().indexName(), "str" + i, Field.Store.NO));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">28 </span></span><span><span style="background-color: transparent">        d.add(new LongField(lngMapper.names().indexName(), i, Field.Store.NO));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">29 </span></span><span><span style="background-color: transparent">        d.add(new DoubleField(dblMapper.names().indexName(), Double.valueOf(i), Field.Store.NO));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">30 </span></span><span><span style="background-color: transparent">        writer.addDocument(d);</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">31 </span></span><span><span style="background-color: transparent">    }</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">32 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">33 </span></span><span><span style="background-color: transparent">    reader = SlowCompositeReaderWrapper.wrap(DirectoryReader.open(writer, true));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">34 </span></span><span><span style="background-color: transparent">}</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">35 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span></pre></td></tr></table></td></tr></table></div></body></html>