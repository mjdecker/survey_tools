<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Tool3</title></head><body><div style="font-family: courier, monospace;"><table style="border-collapse: collapse;"><tr><td style="border: 1px solid black;"><table><tr><th><strong>Original</strong></th></tr><tr><td><pre><span><span style="color: grey"> 1 </span></span><span><span style="background-color: transparent">public boolean enterWhenUninterruptibly(Guard guard, long time, TimeUnit unit) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 2 </span></span><span><span style="background-color: transparent">  if (guard.monitor != this) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 3 </span></span><span><span style="background-color: transparent">    throw new IllegalMonitorStateException();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 4 </span></span><span><span style="background-color: transparent">  }</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 5 </span></span><span><span style="background-color: transparent">  final ReentrantLock lock = this.lock;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 6 </span></span><span><span style="background-color: transparent">  boolean reentrant = lock.isHeldByCurrentThread();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 7 </span></span><span><span style="background-color: transparent">  long startNanos = System.nanoTime();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 8 </span></span><span><span style="background-color: transparent">  long timeoutNanos = unit.toNanos(time);</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 9 </span></span><span><span style="background-color: transparent">  long remainingNanos = timeoutNanos;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">10 </span></span><span><span style="background-color: transparent">  boolean interruptIgnored = false;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">11 </span></span><span><span style="background-color: transparent">  try {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">12 </span></span><span><span style="background-color: transparent">    while (true) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">13 </span></span><span><span style="background-color: transparent">      try {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">14 </span></span><span><span style="background-color: transparent">        if (lock.tryLock(remainingNanos, TimeUnit.NANOSECONDS)) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">15 </span></span><span><span style="background-color: transparent">          break;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">16 </span></span><span><span style="background-color: transparent">        } else {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">17 </span></span><span><span style="background-color: transparent">          return false;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">18 </span></span><span><span style="background-color: transparent">        }</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">19 </span></span><span><span style="background-color: transparent">      } catch (InterruptedException ignored) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">20 </span></span><span><span style="background-color: transparent">        interruptIgnored = true;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">21 </span></span><span><span style="background-color: transparent">      } finally {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">22 </span></span><span><span style="background-color: transparent">        remainingNanos = (timeoutNanos - (System.nanoTime() - startNanos));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">23 </span></span><span><span style="background-color: transparent">      }</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">24 </span></span><span><span style="background-color: transparent">    }</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">25 </span></span><span><span style="background-color: transparent">    boolean satisfied;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">26 </span></span><span><span style="background-color: transparent">    try {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">27 </span></span><span><span style="background-color: transparent">      satisfied = waitUninterruptibly(guard, remainingNanos, reentrant);</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">28 </span></span><span><span style="background-color: transparent">    } </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">catch (Throwable throwable) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">29 </span></span><span><span style="background-color: transparent">      </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">lock.unlock();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">30 </span></span><span><span style="background-color: transparent">      </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">throw Throwables.propagate(throwable);</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">31 </span></span><span><span style="background-color: transparent">    </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">}</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">31 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">32 </span></span><span><span style="background-color: transparent">    </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">if (satisfied) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">33 </span></span><span><span style="background-color: transparent">      return </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">true</span></span><span><span style="background-color: transparent">;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">34 </span></span><span><span style="background-color: transparent">    </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">} else {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">35 </span></span><span><span style="background-color: transparent">      </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">lock.unlock();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">36 </span></span><span><span style="background-color: transparent">      </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">return false;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">37 </span></span><span><span style="background-color: transparent">    </span></span><span style="color:grey; text-decoration: line-through;"><span style="color: black; background-color: rgb(255,187,187); font-weight: bold;">}</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">38 </span></span><span><span style="background-color: transparent">  } finally {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">39 </span></span><span><span style="background-color: transparent">    if (interruptIgnored) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">40 </span></span><span><span style="background-color: transparent">      Thread.currentThread().interrupt();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">41 </span></span><span><span style="background-color: transparent">    }</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">42 </span></span><span><span style="background-color: transparent">  }</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">43 </span></span><span><span style="background-color: transparent">}</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">44 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span></pre></td></tr></table></td><td style="border: 1px solid black; border-collapse: collapse;"><table><tr><th><strong>Modified</strong></th></tr><tr><td><pre><span><span style="color: grey"> 1 </span></span><span><span style="background-color: transparent">public boolean enterWhenUninterruptibly(Guard guard, long time, TimeUnit unit) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 2 </span></span><span><span style="background-color: transparent">    if (guard.monitor != this) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 3 </span></span><span><span style="background-color: transparent">      throw new IllegalMonitorStateException();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 4 </span></span><span><span style="background-color: transparent">    }</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 5 </span></span><span><span style="background-color: transparent">    final ReentrantLock lock = this.lock;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 6 </span></span><span><span style="background-color: transparent">    boolean reentrant = lock.isHeldByCurrentThread();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 7 </span></span><span><span style="background-color: transparent">    long startNanos = System.nanoTime();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 8 </span></span><span><span style="background-color: transparent">    long timeoutNanos = unit.toNanos(time);</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey"> 9 </span></span><span><span style="background-color: transparent">    long remainingNanos = timeoutNanos;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">10 </span></span><span><span style="background-color: transparent">    boolean interruptIgnored = false;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">11 </span></span><span><span style="background-color: transparent">    try {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">12 </span></span><span><span style="background-color: transparent">      while (true) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">13 </span></span><span><span style="background-color: transparent">        try {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">14 </span></span><span><span style="background-color: transparent">          if (lock.tryLock(remainingNanos, TimeUnit.NANOSECONDS)) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">15 </span></span><span><span style="background-color: transparent">            break;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">16 </span></span><span><span style="background-color: transparent">          } else {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">17 </span></span><span><span style="background-color: transparent">            return false;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">18 </span></span><span><span style="background-color: transparent">          }</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">19 </span></span><span><span style="background-color: transparent">        } catch (InterruptedException ignored) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">20 </span></span><span><span style="background-color: transparent">          interruptIgnored = true;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">21 </span></span><span><span style="background-color: transparent">        } finally {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">22 </span></span><span><span style="background-color: transparent">          remainingNanos = (timeoutNanos - (System.nanoTime() - startNanos));</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">23 </span></span><span><span style="background-color: transparent">        }</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">24 </span></span><span><span style="background-color: transparent">      }</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">25 </span></span><span><span style="background-color: transparent">      boolean satisfied </span></span><span><span style="background-color: rgb(0,250,108)  ; font-weight: bold;">= false</span></span><span><span style="background-color: transparent">;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">26 </span></span><span><span style="background-color: transparent">      try {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">27 </span></span><span><span style="background-color: transparent">        satisfied = waitUninterruptibly(guard, remainingNanos, reentrant);</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">28 </span></span><span><span style="background-color: transparent">      } </span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">28 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: rgb(0,250,108)  ; font-weight: bold;">finally {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">29 </span></span><span><span style="background-color: transparent">        </span></span><span><span style="background-color: rgb(0,250,108)  ; font-weight: bold;">if (!satisfied) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">30 </span></span><span><span style="background-color: transparent">          </span></span><span><span style="background-color: rgb(0,250,108)  ; font-weight: bold;">lock.unlock();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">31 </span></span><span><span style="background-color: transparent">        </span></span><span><span style="background-color: rgb(0,250,108)  ; font-weight: bold;">}</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">32 </span></span><span><span style="background-color: transparent">      </span></span><span><span style="background-color: rgb(0,250,108)  ; font-weight: bold;">}</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">33 </span></span><span><span style="background-color: transparent">      return </span></span><span><span style="background-color: rgb(0,250,108)  ; font-weight: bold;">satisfied</span></span><span><span style="background-color: transparent">;</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">   </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">34 </span></span><span><span style="background-color: transparent">    } finally {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">35 </span></span><span><span style="background-color: transparent">      if (interruptIgnored) {</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">36 </span></span><span><span style="background-color: transparent">        Thread.currentThread().interrupt();</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">37 </span></span><span><span style="background-color: transparent">      }</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">38 </span></span><span><span style="background-color: transparent">    }</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">39 </span></span><span><span style="background-color: transparent">  }</span></span><span><span style="background-color: transparent">
</span></span><span><span style="color: grey">40 </span></span><span><span style="background-color: transparent"></span></span><span><span style="background-color: transparent">
</span></span></pre></td></tr></table></td></tr></table></div></body></html>